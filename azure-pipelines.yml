stages:
- stage: DEV
  jobs:
  - job: DevJob
    displayName: Dev
    continueOnError: true
    pool:
      vmImage: 'ubuntu-16.04'
      demand: maven
    steps:
    - task: Maven@3
      displayName: 'Maven pom.xml(lite)'
      inputs:
        mavenPomFile: 'pom-lite.xml'
    - task: Maven@3
      displayName: 'Maven pom.xml(full)'
      inputs:
        mavenPomFile: 'pom-full.xml'
    - task: CopyFiles@2
      displayName: 'Copy Files to: $(build.artifactstagingdirectory)'
      inputs:
        SourceFolder: '$(system.defaultworkingdirectory)'
        Contents: '**/*.jar'
        TargetFolder: '$(build.artifactstagingdirectory)'
    - task: PublishBuildArtifacts@1
      displayName: 'Publish Artifact: drop'
      inputs:
        PathtoPublish: '$(build.artifactstagingdirectory)'

- stage: TEST
  dependsOn: DEV
  jobs:
  - job: TestJob    
    pool:
      vmImage: 'ubuntu-16.04'
      demand: maven 
    steps:
    - script: |
        echo "running tests..."
        echo 'Tests complete.'

- stage: STAGING
  dependsOn: TEST
  jobs:
  - job: StagingJob        
    steps:
    - task: PowerShell@1
      displayName: 'Deploy to Staging'
      inputs:
        scriptType: inlineScript
        inlineScript: |  
          Write-Host "Starting to deploy to Staging..."
          Write-Host "Deploy to staging complete..." 
    - task: GithubRelease@0
      displayName: 'Create GitHub Release'
      inputs:
        githubConnection: zenithworks
        repositoryName: zenithworks/javaMavenApp2
        assets: '$(System.ArtifactsDirectory)\ZenithWorks-Core\drop\target\*.jar'


